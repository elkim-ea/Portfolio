apiVersion: apps/v1
kind: Deployment
metadata:
  name: matcha-frontend
  labels:
    app: matcha-frontend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: matcha-frontend
  template:
    metadata:
      labels:
        app: matcha-frontend
    spec:
      containers:
      - name: matcha-frontend
        image: asia-northeast3-docker.pkg.dev/matcha-480312/matcha-repo/matcha-frontend:latest
        imagePullPolicy: Always
        ports:
          - containerPort: 80
        env:
          # ❗ Nginx 프록시를 사용하도록 상대 경로로 수정 ❗
          - name: VITE_API_BASE_URL
            value: "/api"
          - name: VITE_IMG_BASE_URL
            value: "/uploads"
        # ❗ Nginx ConfigMap 볼륨 마운트 추가 ❗
        volumeMounts:
          - name: nginx-config-volume
            mountPath: /etc/nginx/conf.d/default.conf
            subPath: nginx.conf
      # ❗ Nginx ConfigMap 볼륨 정의 ❗
      volumes:
        - name: nginx-config-volume
          configMap:
            name: frontend-nginx-config