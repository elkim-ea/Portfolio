# server {
#     # 80번 포트에서 요청을 기다립니다.
#     listen 80;

#     # 웹사이트 파일들이 있는 기본 폴더를 지정합니다.
#     root /usr/share/nginx/html;

#     # "/api"로 시작하는 모든 요청을 처리합니다.
#     location /api {
#         # 이 요청들을 백엔드 컨테이너로 전달합니다.
#         # "backend"는 docker-compose.yml에 정의된 백엔드 서비스 이름입니다.
#         proxy_pass http://backend:8080;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     # 그 외의 모든 요청을 처리합니다.
#     location / {
#         # [핵심] 요청한 주소에 파일이 없으면, 무조건 index.html을 보여줍니다.
#         # 이것이 새로고침 문제를 해결하는 마법의 코드입니다.
#         try_files $uri /index.html;
#     }

#     # 이미지 업로드 파일 접근 허용
#     location /uploads {
#         proxy_pass http://backend:8080;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }

##################################################
 # gcp GKE용 nginx.conf
##################################################
server {
    listen 80;
    root /usr/share/nginx/html;

    # API 요청 -> GKE backend service
    location /api {
        proxy_pass http://matcha-backend-service:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # React SPA routing
    location / {
        try_files $uri /index.html;
    }

    # 이미지 업로드도 백엔드로 프록시
    location /uploads {
        proxy_pass http://matcha-backend-service:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
