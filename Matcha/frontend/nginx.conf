server {
    # 80번 포트에서 요청을 기다립니다.
    listen 80;

    # 웹사이트 파일들이 있는 기본 폴더를 지정합니다.
    root /usr/share/nginx/html;

    # --- 1. API 요청 프록시 ---
    # "/api"로 시작하는 모든 요청을 백엔드로 전달합니다.
    location /api/ {
        # ✅ GKE 백엔드 LoadBalancer의 Public IP로 변경
        proxy_pass http://matcha-backend-service:8080;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # --- 2. 이미지 업로드/조회 경로 프록시 ---
    # /uploads/ 로 시작하는 모든 요청을 백엔드로 전달합니다.
    location /uploads/ {
        # ✅ GKE 백엔드 LoadBalancer의 Public IP로 변경
        proxy_pass http://matcha-backend-service:8080;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # --- 3. SPA 라우팅 처리 (✅ 문법 수정) ---
    # 그 외의 모든 요청을 처리합니다.
    location / {
        # 요청한 주소에 파일이 없으면, 무조건 index.html을 보여줍니다.
        try_files $uri $uri/ /index.html;
    }
}